# EasyRDW

## 目标

1. **非常易用**，用户可以只需专注于控制器逻辑部分，选择任何语言编写RDW控制器，调试时使只需要打开一个网页就可以可视化地看到运行效果和reset数据统计
2. **规范性强**，仿真部分、数据部分和RDW控制器完全分离，彻底将RDW当做VR系统中间层来实现，易于移植
3. **通用性强**，将支持不同的空间环境、动态障碍物、用户行为代理，将规范化RDW控制器的输入条件，RDW控制器可根据其输入条件从环境中拿取不同数据

**核心问题：它需要突出哪些特性？和已有框架相比有哪些优劣势？**



## 需求

### **架构-本地化

有一个主服务端web应用，支持通过公网ip特定端口访问。

用户打开web后，可以进行一系列操作，但这些操作**均被本地页面的逻辑所处理，和远程的主服务端无通信。**

**无论实现什么功能，都可以（应该）考虑让用户借助网页端UI操作实现，而不一定在网页之外修改配置。**

### **RDW配置

打开网页后，web界面展示默认的虚拟空间和物理空间（及其障碍物）、walker、数据栏以及一系列按钮（根据需求）。初始显示为静态。

（*注：“用户”指在现实中使用整个应用的人，而“walker”指在RDW中假想的一个仿真行走者*）

用户可以在界面上对虚拟空间和物理空间进行配置，包括其多边形外廓和障碍物。界面提供了一些预置的空间配置供快速选择。

空间的形状可能千奇百怪，且虚拟空间可能很大，需要考虑以适当的形式显示，此外必须有比例尺或距离标识。

用户可以在界面上对虚拟空间的目标点（即分段的行走路径）进行配置，然后可以在虚拟空间中进行浏览。界面提供了一些预置的目标点配置供快速选择。

用户可以上传配置文件，读入后自动完成空间和目标点的配置。

### *在线运行支持

用户可以**上传特定语言的RDW控制器逻辑文件**。文件需要包含**规定接口**的实现。点击“开始”，就可以看到walker开始行走。reset不需要显示转身的过程，只需要以某种形式表示发生了reset即可。界面上会实时显示walker在虚拟和物理空间的位置、朝向和轨迹，数据栏中会显示当前的gain值、已行走距离、已reset次数等数据。用户可以在web端随时暂停/继续运行过程，也可以停止/重启运行。

上传的逻辑文件语言要求至少支持.js（JavaScript），最好能够支持.py（Python）。

在停止运行状态下，用户可以上传新的控制器逻辑文件，覆盖之前的逻辑。

Web界面提供了**在线的编辑栏，可以直接编写代码并作为逻辑文件运行**。

### **本地通信运行支持

用户**在本地运行RDW控制器逻辑程序，与web界面进行通信**。逻辑程序需要包含**规定接口**的实现，**通信仅限于这些接口**。界面行为同上。

在本地提供**适配框架，提供标准的通信接口实现以及其他辅助文件**，减轻用户配置的负担。控制语言要求至少支持.py（Python），后续可以拓展更多语言。

在停止运行状态下，用户可以切换逻辑程序，覆盖之前的逻辑。

### *在线仿真支持

用户上传逻辑文件后，并进行必要的配置后，**点击“仿真”，等待一段时间后可以看到仿真结果（需要显示进度）**。仿真结果除了数据栏中显示reset次数等，还包括可以下载全过程的路径、速度、gain值的统计量等。

### *本地通信仿真支持

用户准备好本地逻辑程序，并进行必要的配置后，点击“仿真”后行为如上。

### *多套接口支持

至少支持以下两套接口，用于适配不同的RDW条件：

（*注：“接受”指web->逻辑，“发送”指逻辑->web*）

1. （标准gain值接口）重定向时，接受walker的位置、朝向、速度和环境信息，发送translation、rotation、curvature三种gain值。重置由任一方主动触发，重置时接受walker的位置和环境信息，发送重置位置和方向。
2. （广义接口）重定向时，接受walker当前步的位置、朝向、速度和环境信息，发送下一步的位置、朝向和速度。重置同上。

### 拓展功能

用户可以配置walker进行更高级的虚拟运动（曲线，多目标点，变速等）。

用户可以定制接口，即逻辑接受和发送的信息。这些信息中可以包含对配置的修改，包括环境。

支持动态障碍物的配置。

支持三维运动。

### 在线支持

在更新的架构中，用户的web操作有一部分会发送到主服务端，并根据主服务端后端的返回结果进行界面更新。

支持在线编译逻辑文件和运行。

支持云仿真。

支持benchmark的构建和展示。



## 参考思路

### 主服务端

对于本地化的架构，后端只需要展示界面，重点在于前端的编写。前端需要囊括页面展示、环境配置、RDW处理、接口处理等逻辑。

Web应用任意选轻量级框架，如FastAPI，Flask。前端可以直接纯HTML5+JavaScript开发，也可以再套前端框架（但感觉没必要）。

### 页面显示和RDW配置

对于2D可视化，原生Canvas实现已经足够。

用户并非一个点，而是有体积的。展示虚拟和物理空间时也可以通过用户的大小来“提示”其所在空间的大小。

考虑对于极端空间的窗口化适配，即只展示空间的某一部分。

### 本地通信运行

考虑优先实现。

利用WebSocket，在用户本地启动服务端，并在web页面连接该地址，从而双工通信。

对于标准gain值接口，RDW主逻辑以及检查运行在web端。对于广义接口，RDW主逻辑运行在本地，本地的框架不仅需要提供接口适配，还需要提供主逻辑（用户可以不用，但我们不能不提供）。

### 在线运行

利用Web Worker处理。全部逻辑运行在web端，按一定帧率显示。

如果需要支持Python，考虑使用在线Python解释库（如Brython）。

### 在线仿真

取消帧率限制，不进行可视化的更新，可以进行数据的更新。

### 本地通信仿真？

也许是一个伪命题：如果每一步都需要通信，将大幅度影响仿真效率；如果将仿真权限完全交给本地程序，则不符合设计的初衷。

### 多套接口支持

内置多套运行逻辑即可。



## 参考已有框架

https://github.com/USC-ICT-MxR/RDWT

https://github.com/yaoling1997/OpenRDW

https://github.com/omegafantasy/OpenRDW2

https://github.com/pasumi/pasumi